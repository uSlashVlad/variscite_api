[Also available on English](README.md)

# Variscite API

**Часть проекта "Варисцит". Также есть [библиотека для Dart](https://github.com/uSlashVlad/variscite_dart) и [клиентское приложение](https://github.com/uSlashVlad/variscite_mobile)**

API основаное на HTTP/HTTPS протоколе, выполняющее роль слоя между базой данных и клиентскими приложениями. Основные функции API на данный момент:

- авторизация пользователей, группы
- добавление и управление географическими структурами (точки, линии, полигоны)
- работа с пользовательской геолокацией

Разработано данное серверное приложение на TypeScript с использованием NodeJS, с Fastify в качестве веб-сервера. Генерация документации API и валидация запросов проводятся с использованием спецификации OpenAPI (сама спецификация расположена в *specs/api-v0.yml*). Рекомендуется работать с этим серверными приложением при помощи docker-compose. В качестве главной базы данных используется MongoDB.

# Для пользователей

**Эти инструкции общие как для разработчиков, так и для администраторов**

Для работы приложения требуется установить переменные окружения в *.env* файле. Пример конфигурации находится в *.env.example*.

Если у вас нет на данный момент базы данных MongoDB, то вот официальные гайды по установке и настройке:

- [Установка](https://docs.mongodb.com/manual/installation/)
- [Необходимая настройка](https://docs.mongodb.com/manual/tutorial/enable-authentication/)

Также можно воспользоваться [MongoDB Atlas](https://www.mongodb.com/atlas)

Для запуска API по дальнейшей инструкции требуется Docker Compose. [Официальный гайд по установке](https://docs.docker.com/compose/install/)

## Для разработчиков

Для запуска приложения в формате для разработки достаточно собрать контейнер:
```sh
docker-compose build
```
и запустить его:
```sh
docker-compose up
```

При изменении файлов, программа в контейнере будет автоматически перезапускаться благодаря [Nodemon](https://www.npmjs.com/package/nodemon).

## Для администраторов

Если требуется развернуть приложение в уже конечном окружении на сервере, то для этого необходимо собрать контейнер следующей командой:
```sh
docker-compose -f docker-compose.yml -f docker-compose.prod.yml build
```
и запустить при помощи:
```sh
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d
```

При этом приложение будет работать в фоне. Проверить его работу из терминала можно следующей командой:
```sh
# Надо отметить, что порт может отличаться, так как он задаётся пользователем в .env файле
curl http://localhost:80/status
```
Ответ должен быть следующим:
```json
{"text":"OK!"}
```